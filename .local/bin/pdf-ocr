#!/bin/bash
TMPD=`mktemp -d`
DATUAL=`pwd`
cd $TMPD
echo -n "Criando imagens em $TMPD ... ";
pdftoppm -r 300 "$DATUAL/$2" temp
echo "feito!"

for f in *.ppm; do
    echo -n "Reconhecendo caracteres na página $f ...";
    tesseract -l "$1" --dpi 300 "$f" "$f" pdf
    echo "feito!"
done

echo -n "Criando PDF pesquisável ... "
cd "$DATUAL"
pdftk $TMPD/*.pdf cat output out.pdf
gs -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/ebook -dNOPAUSE -dQUIET -dBATCH -sOutputFile="${2%.pdf}_novo.pdf" out.pdf
echo "feito!"
echo -n "Removendo temporários de $TMPD ... ";
rm -rf $TMPD
rm -f  out.pdf
echo "feito!"
echo ""
echo " Arquivo criado:" ${2%.pdf}"_novo.pdf"
